!function(t){function e(n){if(i[n])return i[n].exports;var r=i[n]={exports:{},id:n,loaded:!1};return t[n].call(r.exports,r,r.exports,e),r.loaded=!0,r.exports}var i={};return e.m=t,e.c=i,e.p="",e(0)}([function(t,e,i){if(i(1),"undefined"==typeof AFRAME)throw new Error("Component attempted to register before AFRAME was available.");AFRAME.registerSystem("audio-visualizer",{init:function(){this.dancers={}},getOrCreateAudio:function(t){return this.dancers[t]?this.dancers[t]:this.createAudio(t)},createAudio:function(t){var e=new Dancer;return e.load({src:t}),e.play(),this.dancers[t]=e,e}}),AFRAME.registerComponent("audio-visualizer",{schema:{unique:{"default":!1},src:{type:"src"}},init:function(){this.dancer=null},update:function(){var t=this.data,e=this.system;t.src&&(t.unique?this.dancer=e.createAudio(t.src):this.dancer=e.getOrCreateAudio(t.src),this.el.emit("audio-visualizer-ready",{dancer:this.dancer}))}}),AFRAME.registerComponent("audio-visualizer-kick",{dependencies:["audio-visualizer"],schema:{frequency:{type:"array","default":[127,129]},threshold:{"default":1e-5},decay:{"default":1e-5}},init:function(){this.kick=!1},update:function(){function t(t){var e=t.createKick(r);e.on()}var e=this.data,i=this.el,n=this,r=AFRAME.utils.extend(e,{onKick:function(t,e){n.kick||(i.emit("audio-visualizer-kick-start",this.arguments),n.kick=!0)},offKick:function(t,e){n.kick&&(i.emit("audio-visualizer-kick-end",this.arguments),n.kick=!1)}}),a=this.el.components["audio-visualizer"].dancer;a?t(a):this.el.addEventListener("audio-visualizer-ready",function(e){t(e.detail.dancer)})}})},function(t,e){function n(t,e){this.bufferSize=t,this.sampleRate=e,this.bandwidth=2/t*e/2,this.spectrum=new Float32Array(t/2),this.real=new Float32Array(t),this.imag=new Float32Array(t),this.peakBand=0,this.peak=0,this.getBandFrequency=function(t){return this.bandwidth*t+this.bandwidth/2},this.calculateSpectrum=function(){for(var e,i,n,r=this.spectrum,a=this.real,s=this.imag,o=2/this.bufferSize,u=Math.sqrt,c=0,h=t/2;h>c;c++)e=a[c],i=s[c],n=o*u(e*e+i*i),n>this.peak&&(this.peakBand=c,this.peak=n),r[c]=n}}function r(t,e){n.call(this,t,e),this.reverseTable=new Uint32Array(t);for(var i,r=1,a=t>>1;t>r;){for(i=0;r>i;i++)this.reverseTable[i+r]=this.reverseTable[i]+a;r<<=1,a>>=1}for(this.sinTable=new Float32Array(t),this.cosTable=new Float32Array(t),i=0;t>i;i++)this.sinTable[i]=Math.sin(-Math.PI/i),this.cosTable[i]=Math.cos(-Math.PI/i)}!function(){function t(){for(var t in this.sections)this.sections[t].condition()&&this.sections[t].callback.call(this)}var e=function(){this.audioAdapter=e._getAdapter(this),this.events={},this.sections=[],this.bind("update",t)};e.version="0.3.2",e.adapters={},e.prototype={load:function(t){return t instanceof HTMLElement?(this.source=t,"flash"===e.isSupported()&&(this.source={src:e._getMP3SrcFromAudio(t)})):(this.source=window.Audio?new Audio:{},this.source.src=e._makeSupportedPath(t.src,t.codecs)),this.audio=this.audioAdapter.load(this.source),this},play:function(){return this.audioAdapter.play(),this},pause:function(){return this.audioAdapter.pause(),this},setVolume:function(t){return this.audioAdapter.setVolume(t),this},createKick:function(t){return new e.Kick(this,t)},bind:function(t,e){return this.events[t]||(this.events[t]=[]),this.events[t].push(e),this},unbind:function(t){return this.events[t]&&delete this.events[t],this},trigger:function(t){var e=this;return this.events[t]&&this.events[t].forEach(function(t){t.call(e)}),this},getVolume:function(){return this.audioAdapter.getVolume()},getProgress:function(){return this.audioAdapter.getProgress()},getTime:function(){return this.audioAdapter.getTime()},getFrequency:function(t,e){var i=0;if(void 0!==e){for(var n=t;e>=n;n++)i+=this.getSpectrum()[n];return i/(e-t+1)}return this.getSpectrum()[t]},getWaveform:function(){return this.audioAdapter.getWaveform()},getSpectrum:function(){return this.audioAdapter.getSpectrum()},isLoaded:function(){return this.audioAdapter.isLoaded},isPlaying:function(){return this.audioAdapter.isPlaying},after:function(t,e){var i=this;return this.sections.push({condition:function(){return i.getTime()>t},callback:e}),this},before:function(t,e){var i=this;return this.sections.push({condition:function(){return i.getTime()<t},callback:e}),this},between:function(t,e,i){var n=this;return this.sections.push({condition:function(){return n.getTime()>t&&n.getTime()<e},callback:i}),this},onceAt:function(t,e){var i=this,n=null;return this.sections.push({condition:function(){return i.getTime()>t&&!this.called},callback:function(){e.call(this),n.called=!0},called:!1}),n=this.sections[this.sections.length-1],this}},window.Dancer=e}(),function(t){function e(){var t=!!(navigator.vendor||"").match(/Apple/),e=navigator.userAgent.match(/Version\/([^ ]*)/);return e=e?parseFloat(e[1]):0,t&&6>=e}var i={mp3:"audio/mpeg;",ogg:'audio/ogg; codecs="vorbis"',wav:'audio/wav; codecs="1"',aac:'audio/mp4; codecs="mp4a.40.2"'},n=document.createElement("audio");t.options={},t.setOptions=function(e){for(var i in e)e.hasOwnProperty(i)&&(t.options[i]=e[i])},t.isSupported=function(){return window.Float32Array&&window.Uint32Array?e()||!window.AudioContext&&!window.webkitAudioContext?a.versionAtLeast(9)?"flash":"":"webaudio":null},t.canPlay=function(e){n.canPlayType;return!!("flash"===t.isSupported()?"mp3"===e.toLowerCase():n.canPlayType&&n.canPlayType(i[e.toLowerCase()]).replace(/no/,""))},t.addPlugin=function(e,i){void 0===t.prototype[e]&&(t.prototype[e]=i)},t._makeSupportedPath=function(e,i){if(!i)return e;for(var n=0;n<i.length;n++)if(t.canPlay(i[n]))return e+"."+i[n];return e},t._getAdapter=function(e){switch(t.isSupported()){case"webaudio":return new t.adapters.webaudio(e);case"flash":return new t.adapters.flash(e);default:return null}},t._getMP3SrcFromAudio=function(t){var e=t.children;if(t.src)return t.src;for(var i=e.length;i--;)if((e[i].type||"").match(/audio\/mpeg/))return e[i].src;return null}}(window.Dancer),function(t){var e=function(e,i){i=i||{},this.dancer=e,this.frequency=i.frequency!==t?i.frequency:[0,10],this.threshold=i.threshold!==t?i.threshold:.3,this.decay=i.decay!==t?i.decay:.02,this.onKick=i.onKick,this.offKick=i.offKick,this.isOn=!1,this.currentThreshold=this.threshold;var n=this;this.dancer.bind("update",function(){n.onUpdate()})};e.prototype={on:function(){return this.isOn=!0,this},off:function(){return this.isOn=!1,this},set:function(e){e=e||{},this.frequency=e.frequency!==t?e.frequency:this.frequency,this.threshold=e.threshold!==t?e.threshold:this.threshold,this.decay=e.decay!==t?e.decay:this.decay,this.onKick=e.onKick||this.onKick,this.offKick=e.offKick||this.offKick},onUpdate:function(){if(this.isOn){var t=this.maxAmplitude(this.frequency);t>=this.currentThreshold&&t>=this.threshold?(this.currentThreshold=t,this.onKick&&this.onKick.call(this.dancer,t)):(this.offKick&&this.offKick.call(this.dancer,t),this.currentThreshold-=this.decay)}},maxAmplitude:function(t){var e=0,i=this.dancer.getSpectrum();if(!t.length)return t<i.length?i[~~t]:null;for(var n=t[0],r=t[1];r>=n;n++)i[n]>e&&(e=i[n]);return e}},window.Dancer.Kick=e}(),function(){function t(){this.source=this.context.createMediaElementSource(this.audio),this.source.connect(this.proc),this.source.connect(this.gain),this.gain.connect(this.context.destination),this.proc.connect(this.context.destination),this.isLoaded=!0,this.progress=1,this.dancer.trigger("loaded")}var e=2048,i=44100,n=function(t){this.dancer=t,this.audio=new Audio,this.context=window.AudioContext?new window.AudioContext:new window.webkitAudioContext};n.prototype={load:function(n){var a=this;return this.audio=n,this.isLoaded=!1,this.progress=0,this.context.createScriptProcessor||(this.context.createScriptProcessor=this.context.createJavascriptNode),this.proc=this.context.createScriptProcessor(e/2,1,1),this.proc.onaudioprocess=function(t){a.update.call(a,t)},this.context.createGain||(this.context.createGain=this.context.createGainNode),this.gain=this.context.createGain(),this.fft=new r(e/2,i),this.signal=new Float32Array(e/2),this.audio.readyState<3?this.audio.addEventListener("canplay",function(){t.call(a)}):t.call(a),this.audio.addEventListener("progress",function(t){t.currentTarget.duration&&(a.progress=t.currentTarget.seekable.end(0)/t.currentTarget.duration)}),this.audio},play:function(){this.audio.play(),this.isPlaying=!0},pause:function(){this.audio.pause(),this.isPlaying=!1},setVolume:function(t){this.gain.gain.value=t},getVolume:function(){return this.gain.gain.value},getProgress:function(){return this.progress},getWaveform:function(){return this.signal},getSpectrum:function(){return this.fft.spectrum},getTime:function(){return this.audio.currentTime},update:function(t){if(this.isPlaying&&this.isLoaded){var i,n=[],r=t.inputBuffer.numberOfChannels,a=e/r,s=function(t,e){return t[i]+e[i]};for(i=r;i--;)n.push(t.inputBuffer.getChannelData(i));for(i=0;a>i;i++)this.signal[i]=r>1?n.reduce(s)/r:n[0][i];this.fft.forward(this.signal),this.dancer.trigger("update")}}},Dancer.adapters.webaudio=n}(),function(){function t(){var t=this;s=!0,e(Dancer.options.flashJS,function(){soundManager=new SoundManager,soundManager.flashVersion=9,soundManager.flash9Options.useWaveformData=!0,soundManager.useWaveformData=!0,soundManager.useHighPerformance=!0,soundManager.useFastPolling=!0,soundManager.multiShot=!1,soundManager.debugMode=!1,soundManager.debugFlash=!1,soundManager.url=Dancer.options.flashSWF,soundManager.onready(function(){a=!0,t.load()}),soundManager.ontimeout(function(){console.error("Error loading SoundManager2.swf")}),soundManager.beginDelayedInit()})}function e(t,e){var i=document.createElement("script"),n=document.getElementsByTagName("script")[0];i.type="text/javascript",i.src=t,i.onload=e,n.parentNode.insertBefore(i,n)}var i=1024,n=44100,a=!1,s=!1,o=.93,u=function(t){this.dancer=t,this.wave_L=[],this.wave_R=[],this.spectrum=[],window.SM2_DEFER=!0};u.prototype={load:function(e){var a=this;return this.path=e?e.src:this.path,this.isLoaded=!1,this.progress=0,!window.soundManager&&!s&&t.call(this),window.soundManager&&(this.audio=soundManager.createSound({id:"dancer"+Math.random(),url:this.path,stream:!0,autoPlay:!1,autoLoad:!0,whileplaying:function(){a.update()},whileloading:function(){a.progress=this.bytesLoaded/this.bytesTotal},onload:function(){a.fft=new r(i,n),a.signal=new Float32Array(i),a.waveform=new Float32Array(i),a.isLoaded=!0,a.progress=1,a.dancer.trigger("loaded")}}),this.dancer.audio=this.audio),this.audio},play:function(){this.audio.play(),this.isPlaying=!0},pause:function(){this.audio.pause(),this.isPlaying=!1},setVolume:function(t){this.audio.setVolume(100*t)},getVolume:function(){return this.audio.volume/100},getProgress:function(){return this.progress},getWaveform:function(){return this.waveform},getSpectrum:function(){return this.fft.spectrum},getTime:function(){return this.audio.position/1e3},update:function(){if(this.isPlaying||this.isLoaded){this.wave_L=this.audio.waveformData.left,this.wave_R=this.audio.waveformData.right;for(var t,e=0,i=this.wave_L.length;i>e;e++)t=parseFloat(this.wave_L[e])+parseFloat(this.wave_R[e]),this.waveform[2*e]=t/2,this.waveform[2*e+1]=t/2,this.signal[2*e]=t*o,this.signal[2*e+1]=t*o;this.fft.forward(this.signal),this.dancer.trigger("update")}}},Dancer.adapters.flash=u}(),r.prototype.forward=function(t){var e=this.bufferSize,i=this.cosTable,n=this.sinTable,r=this.reverseTable,a=this.real,s=this.imag,o=(this.spectrum,Math.floor(Math.log(e)/Math.LN2));if(Math.pow(2,o)!==e)throw"Invalid buffer size, must be a power of 2.";if(e!==t.length)throw"Supplied buffer is not the same size as defined FFT. FFT Size: "+e+" Buffer Size: "+t.length;var u,c,h,d,l,f,p,g,v,m=1;for(v=0;e>v;v++)a[v]=t[r[v]],s[v]=0;for(;e>m;){u=i[m],c=n[m],h=1,d=0;for(var w=0;m>w;w++){for(v=w;e>v;)l=v+m,f=h*a[l]-d*s[l],p=h*s[l]+d*a[l],a[l]=a[v]-f,s[l]=s[v]-p,a[v]+=f,s[v]+=p,v+=m<<1;g=h,h=g*u-d*c,d=g*c+d*u}m<<=1}return this.calculateSpectrum()};var a=new function(){var t=this;t.installed=!1,t.raw="",t.major=-1,t.minor=-1,t.revision=-1,t.revisionStr="";var e=[{name:"ShockwaveFlash.ShockwaveFlash.7",version:function(t){return n(t)}},{name:"ShockwaveFlash.ShockwaveFlash.6",version:function(t){var e="6,0,21";try{t.AllowScriptAccess="always",e=n(t)}catch(i){}return e}},{name:"ShockwaveFlash.ShockwaveFlash",version:function(t){return n(t)}}],n=function(t){var e=-1;try{e=t.GetVariable("$version")}catch(i){}return e},r=function(t){var e=-1;try{e=new ActiveXObject(t)}catch(i){e={activeXError:!0}}return e},a=function(t){var e=t.split(",");return{raw:t,major:parseInt(e[0].split(" ")[1],10),minor:parseInt(e[1],10),revision:parseInt(e[2],10),revisionStr:e[2]}},s=function(t){var e=t.split(/ +/),i=e[2].split(/\./),n=e[3];return{raw:t,major:parseInt(i[0],10),minor:parseInt(i[1],10),revisionStr:n,revision:o(n)}},o=function(e){return parseInt(e.replace(/[a-zA-Z]/g,""),10)||t.revision};t.majorAtLeast=function(e){return t.major>=e},t.minorAtLeast=function(e){return t.minor>=e},t.revisionAtLeast=function(e){return t.revision>=e},t.versionAtLeast=function(e){var n=[t.major,t.minor,t.revision],r=Math.min(n.length,arguments.length);for(i=0;i<r;i++){if(n[i]>=arguments[i]){if(i+1<r&&n[i]==arguments[i])continue;return!0}return!1}},t.FlashDetect=function(){if(navigator.plugins&&navigator.plugins.length>0){var i="application/x-shockwave-flash",n=navigator.mimeTypes;if(n&&n[i]&&n[i].enabledPlugin&&n[i].enabledPlugin.description){var o=n[i].enabledPlugin.description,u=s(o);t.raw=u.raw,t.major=u.major,t.minor=u.minor,t.revisionStr=u.revisionStr,t.revision=u.revision,t.installed=!0}}else if(-1==navigator.appVersion.indexOf("Mac")&&window.execScript)for(var o=-1,c=0;c<e.length&&-1==o;c++){var h=r(e[c].name);if(!h.activeXError&&(t.installed=!0,o=e[c].version(h),-1!=o)){var u=a(o);t.raw=u.raw,t.major=u.major,t.minor=u.minor,t.revision=u.revision,t.revisionStr=u.revisionStr}}}()};a.JS_RELEASE="1.0.4"}]);